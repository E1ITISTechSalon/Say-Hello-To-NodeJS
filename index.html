<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Say-hello-to-nodejs by E1ITISTechSalon</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Say-hello-to-nodejs</h1>
        <p>Brief introductions about NodeJS</p>
        <p class="view"><a href="https://github.com/E1ITISTechSalon/Say-Hello-To-NodeJS">View the Project on GitHub <small>E1ITISTechSalon/Say-Hello-To-NodeJS</small></a></p>
        <ul>
          <li><a href="https://github.com/E1ITISTechSalon/Say-Hello-To-NodeJS/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/E1ITISTechSalon/Say-Hello-To-NodeJS/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/E1ITISTechSalon/Say-Hello-To-NodeJS">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <p>This document is going to give you a brief introduction to NodeJS web development by creating a simple blog and tell you how to deploy the blog on <a href="https://www.appfog.com/">Appfog</a>. </p>

<h2>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>First things first, you should download <a href="http://nodejs.org/download/">NodeJS</a> for your platform and install it.</p>

<p>When you install NodeJS on your OS, you will also get the <a href="https://npmjs.org/">NPM</a> tool at the same time. We will use NPM tool to install all the modules that our blog system depend upon.</p>

<h2>
<a name="dependencies" class="anchor" href="#dependencies"><span class="octicon octicon-link"></span></a>Dependencies</h2>

<h4>
<a name="--mongodb" class="anchor" href="#--mongodb"><span class="octicon octicon-link"></span></a>- <a href="http://www.mongodb.org/">MongoDB</a>
</h4>

<p>We use MongoDB to store our data. You can get it <a href="http://www.mongodb.org/downloads">here</a>. </p>

<h4>
<a name="--expressjs" class="anchor" href="#--expressjs"><span class="octicon octicon-link"></span></a>- <a href="http://expressjs.com/">ExpressJS</a>
</h4>

<p>We use ExpressJS as our web framework. You can install it by inputting below command:</p>

<div class="highlight highlight-Batchfile"><pre>$ npm install -g express
</pre></div>

<h4>
<a name="--ejs" class="anchor" href="#--ejs"><span class="octicon octicon-link"></span></a>- <a href="http://www.embeddedjs.com/">EJS</a>
</h4>

<p>We use EJS as our template engine. We will install it later when we create the blog project.</p>

<h2>
<a name="start-with-generated-skeleton" class="anchor" href="#start-with-generated-skeleton"><span class="octicon octicon-link"></span></a>Start with generated skeleton</h2>

<p>First, we use <code>express</code> to generate a skeleton web application.</p>

<div class="highlight highlight-Batchfile"><pre>$ express -e JBlog

   create : JBlog
   create : JBlog<span class="n">/package.json</span>
   create : JBlog<span class="n">/app.js</span>
   create : JBlog<span class="n">/public</span>
   create : JBlog<span class="n">/public/javascripts</span>
   create : JBlog<span class="n">/public/images</span>
   create : JBlog<span class="n">/public/stylesheets</span>
   create : JBlog<span class="n">/public/stylesheets/style.css</span>
   create : JBlog<span class="n">/routes</span>
   create : JBlog<span class="n">/routes/index.js</span>
   create : JBlog<span class="n">/routes/user.js</span>
   create : JBlog<span class="n">/views</span>
   create : JBlog<span class="n">/views/index.ejs</span>

   install dependencies:
     $ <span class="k">cd</span> JBlog &amp;&amp; npm install

   run the app:
     $ node app
</pre></div>

<blockquote>
<p><em>We add option <code>-e</code> in the command so that the express will use <code>EJS</code> as our default template engine.</em></p>
</blockquote>

<p>As express says, we can use below command to install dependencies and run it:</p>

<div class="highlight highlight-Batchfile"><pre># this command will install the dependencies in package.json
$ <span class="k">cd</span> JBlog &amp;&amp; npm install  

# this command will run the application
$ node app
</pre></div>

<h2>
<a name="routes" class="anchor" href="#routes"><span class="octicon octicon-link"></span></a>Routes</h2>

<p>We will use the generated <code>routes</code> folder as our controller holder place.</p>

<p>Add below codes above <code>app.get('/', routes.index);</code> in <code>app.js</code> file and delete below lines in <code>app.js</code> file.</p>

<hr><p><strong>introduce the order maters under express.</strong></p>

<hr><div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./routes/user'</span><span class="p">);</span>  <span class="c1">// delete</span>
<span class="p">...</span>
<span class="nx">routes</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span>  <span class="c1">// add</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="nx">routes</span><span class="p">.</span><span class="nx">index</span><span class="p">);</span>  <span class="c1">// delete</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/users'</span><span class="p">,</span> <span class="nx">user</span><span class="p">.</span><span class="nx">list</span><span class="p">);</span>  <span class="c1">// delete</span>
</pre></div>

<p>Delete <code>user.js</code> file in <code>routes</code> folder and use below codes to replace the content in <code>index.js</code> file.</p>

<hr><p><strong>introduce require path things</strong></p>

<p><strong>export things</strong></p>

<hr><div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">post</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./post'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">admin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./admin'</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// home page</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="nx">post</span><span class="p">.</span><span class="nx">home</span><span class="p">);</span>

    <span class="c1">// single blog page</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/blog/:id'</span><span class="p">,</span> <span class="nx">post</span><span class="p">.</span><span class="nx">post</span><span class="p">);</span>

    <span class="c1">// login page</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/admin/login'</span><span class="p">,</span> <span class="nx">admin</span><span class="p">.</span><span class="nx">login</span><span class="p">);</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">'/admin/login'</span><span class="p">,</span> <span class="nx">admin</span><span class="p">.</span><span class="nx">login</span><span class="p">);</span>

    <span class="c1">// blog adding page</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/admin/add'</span><span class="p">,</span> <span class="nx">admin</span><span class="p">.</span><span class="nx">add</span><span class="p">);</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">'/admin/add'</span><span class="p">,</span> <span class="nx">admin</span><span class="p">.</span><span class="nx">add</span><span class="p">);</span>

    <span class="c1">// blog editting page</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/admin/edit/:id'</span><span class="p">,</span> <span class="nx">admin</span><span class="p">.</span><span class="nx">add</span><span class="p">);</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">'/admin/edit/:id'</span><span class="p">,</span> <span class="nx">admin</span><span class="p">.</span><span class="nx">add</span><span class="p">);</span>

    <span class="c1">// blog deleting page</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/admin/delete/:id'</span><span class="p">,</span> <span class="nx">admin</span><span class="p">.</span><span class="nx">add</span><span class="p">);</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">'/admin/delete/:id'</span><span class="p">,</span> <span class="nx">admin</span><span class="p">.</span><span class="nx">add</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Then we add <code>post.js</code> file and <code>admin.js</code> file under <code>routes</code> folder and use below codes to fill them:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// post.js</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">home</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">'home page'</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">post</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">'single blog page'</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<div class="highlight highlight-javascript"><pre><span class="c1">// admin.js</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">login</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">'login page'</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">add</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">'add page'</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">edit</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">'edit page'</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">exports</span><span class="p">.</span><span class="k">delete</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">'delete page'</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<h2>
<a name="models" class="anchor" href="#models"><span class="octicon octicon-link"></span></a>Models</h2>

<p>We use mongodb as storage, so we need to install the driver first. Add mongodb middleware in <code>package.json</code> file.</p>

<div class="highlight highlight-json"><pre><span class="p">{</span>
  <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"JBlog"</span><span class="p">,</span>
  <span class="nt">"version"</span><span class="p">:</span> <span class="s2">"0.0.1"</span><span class="p">,</span>
  <span class="nt">"private"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nt">"scripts"</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">"start"</span><span class="p">:</span> <span class="s2">"node app.js"</span>
  <span class="p">},</span>
  <span class="nt">"dependencies"</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">"express"</span><span class="p">:</span> <span class="s2">"3.3.5"</span><span class="p">,</span>
    <span class="nt">"ejs"</span><span class="p">:</span> <span class="s2">"*"</span><span class="p">,</span>
    <span class="nt">"mongodb"</span><span class="p">:</span> <span class="s2">"*"</span> <span class="err">//</span> <span class="err">add</span> <span class="err">this</span> <span class="err">line</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>And then install it:</p>

<div class="highlight highlight-Batchfile"><pre>$ npm install --save
</pre></div>

<p>Create a new folder named <code>models</code> under our project.</p>

<p>Then save below codes as <code>db.js</code> and put it under <code>models</code> folder.</p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">mongodb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'mongodb'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">Db</span> <span class="o">=</span> <span class="nx">mongodb</span><span class="p">.</span><span class="nx">Db</span><span class="p">,</span>
    <span class="nx">Connection</span> <span class="o">=</span> <span class="nx">mongodb</span><span class="p">.</span><span class="nx">Connection</span><span class="p">,</span>
    <span class="nx">Server</span> <span class="o">=</span> <span class="nx">mongodb</span><span class="p">.</span><span class="nx">Server</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">db_name</span> <span class="o">=</span> <span class="s1">'blog'</span><span class="p">,</span>
    <span class="nx">db_host</span> <span class="o">=</span> <span class="s1">'localhost'</span><span class="p">;</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Db</span><span class="p">(</span><span class="nx">db_name</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Server</span><span class="p">(</span><span class="nx">db_host</span><span class="p">,</span> <span class="nx">Connection</span><span class="p">.</span><span class="nx">DEFAULT_PORT</span><span class="p">,</span> <span class="p">{}));</span>
</pre></div>

<p>Now we can use <code>db.js</code> to access mongodb.</p>

<p>It's time to create our <code>user</code> model. Create a <code>user.js</code> and put it under <code>models</code> folder. After that, fill it with below code.</p>

<div class="highlight highlight-javascript"><pre>
</pre></div>
      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/E1ITISTechSalon">E1ITISTechSalon</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>